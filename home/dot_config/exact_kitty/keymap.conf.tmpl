# Clear default keymap.
clear_all_shortcuts yes
clear_all_mouse_actions yes

# Set kitty modifier key.
kitty_mod alt

# Mouse

# Click the link under the mouse or move the cursor.
mouse_map left click ungrabbed mouse_handle_click selection link prompt

# Click the link under the mouse or move the cursor even when grabbed.
mouse_map kitty_mod+left release grabbed,ungrabbed mouse_handle_click selection link prompt

# Discard press event for link click
mouse_map kitty_mod+left press grabbed discard_event

# Start selecting text.
mouse_map left press ungrabbed mouse_selection normal

# Extend the current selection.
mouse_map right press ungrabbed mouse_selection extend

# Start selecting text in a rectangle.
mouse_map kitty_mod+right press ungrabbed,grabbed mouse_selection rectangle

# Select a word.
mouse_map left doublepress ungrabbed mouse_selection word

# Select a line.
mouse_map left triplepress ungrabbed mouse_selection line

# Select line from point.
mouse_map kitty_mod+left triplepress ungrabbed mouse_selection line_from_point

# Setup kitty-scrollback.nvim.
# https://github.com/mikesmithgh/kitty-scrollback.nvim#%EF%B8%8F-setup
action_alias kitty_scrollback_nvim kitten python/kitty_scrollback_nvim.py

# Setup kitty smart-splits.nim.
# https://github.com/mrjones2014/smart-splits.nvim#kitty
action_alias smart_splits_relative_resize kitten relative_resize.py

# Navigate kitty windows and Neovim splits

map ctrl+j neighboring_window down
map ctrl+k neighboring_window up
map ctrl+h neighboring_window left
map ctrl+l neighboring_window right
map --when-focus-on var:IS_NVIM ctrl+j
map --when-focus-on var:IS_NVIM ctrl+k
map --when-focus-on var:IS_NVIM ctrl+h
map --when-focus-on var:IS_NVIM ctrl+l

# Resize kitty windows and Neovim splits

{{- $resizeAmount := "3" -}}
map alt+j smart_splits_relative_resize down {{ $resizeAmount }}
map alt+k smart_splits_relative_resize up {{ $resizeAmount }}
map alt+h smart_splits_relative_resize left {{ $resizeAmount }}
map alt+l smart_splits_relative_resize right {{ $resizeAmount }}
map --when-focus-on var:IS_NVIM alt+j
map --when-focus-on var:IS_NVIM alt+k
map --when-focus-on var:IS_NVIM alt+h
map --when-focus-on var:IS_NVIM alt+l

# Copy and paste

map ctrl+c copy_or_noop
map kitty_mod+c copy_to_clipboard
map kitty_mod+v paste_from_clipboard

# Adjust font size

map kitty_mod+equal change_font_size all +2.0
map kitty_mod+minus change_font_size all -2.0
map kitty_mod+backspace change_font_size all 0

{{- $leader := "Ctrl+s" -}}
{{ $oneshot := "combine : set_colors --reset : pop_keyboard_mode" }}

map --new-mode normal {{ $leader }}
map {{ $leader }} combine : push_keyboard_mode normal : set_colors background=#1a1a2e
map --mode normal {{ $leader }} {{ $oneshot }}
map --mode normal esc {{ $oneshot }}
map --mode normal tab {{ $oneshot }} : new_tab
map --mode normal shift+tab {{ $oneshot }} : close_tab
map --mode normal p {{ $oneshot }} : prev_tab
map --mode normal n {{ $oneshot }} : next_tab
map --mode normal enter {{ $oneshot }} : close_window
map --mode normal space {{ $oneshot }} : next_layout
map --mode normal shift+space {{ $oneshot }} : last_used_layout
map --mode normal j {{ $oneshot }} : launch --location=hsplit
map --mode normal l {{ $oneshot }} : launch --location=vsplit
map --mode normal h {{ $oneshot }} : swap_with_window
map --mode normal k {{ $oneshot }} : open_url_with_hints
map --mode normal f {{ $oneshot }} : kitten hints --type path --program @
map --mode normal g {{ $oneshot }} : kitten hints --type hash --program @

map --mode normal q {{ $oneshot }} : show_last_non_empty_command_output
map --mode normal c {{ $oneshot }} : copy_to_clipboard
map --mode normal v {{ $oneshot }} : paste_from_clipboard
map --mode normal u {{ $oneshot }} : show_scrollback
map --mode normal e {{ $oneshot }} : kitty_scrollback_nvim --config ksb_builtin_last_cmd_output
map --mode normal shift+e {{ $oneshot }} : kitty_scrollback_nvim
