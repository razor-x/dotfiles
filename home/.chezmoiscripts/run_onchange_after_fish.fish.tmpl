#!/usr/bin/env fish

{{ $hash := include (joinPath .chezmoi.homeDir ".config" "fish" "fish_plugins") | sha256sum -}}

{{- range (list "fish" "delve") -}}
  {{- $plugin := . -}}
  {{- range (list "completions" "conf.d" "functions" "themes") -}}
    {{- $dir := printf "%s/.local/share/plugin/%s/%s" $.chezmoi.homeDir $plugin . -}}
    {{- range (glob (printf "%s/*.fish" $dir)) -}}
      {{- $hash = printf "%s%s" $hash (include . | sha256sum) | sha256sum -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

# hash: {{ sha256sum $hash }}

# Clear Fish greeting.
set --universal fish_greeting

# Set fifc fifc_binding.
set --universal fifc_keybinding ctrl-tab

if type --query fish_config
    fish_config theme choose '{{ template "theme" (merge (dict "app" "fish") .) }}'
else
    echo 'Cannot update fish theme: fish_config not found.'
    return 1
end

if type --query fisher
    fisher update
else
    echo 'Cannot update fish plugins: fisher is not installed.'
    return 1
end

if type --query tide
    configure_tide_prompt
else
    echo 'Cannot configure Tide: the tide fish plugin is not installed.'
    return 1
end
